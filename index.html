<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Letters</title>
  </head>
  <body>
    <h1 id="key"></h1>
    <div id="output"></div>

    <script>

        const outputEl = document.getElementById("output");
        const keyPressed = document.getElementById("key");

        class Character {
            size = [20, 20];
            position = [30, 0];
            speed = [0, 0];
            element = null;
        }

        const char = new Character();

        var intervalId = window.setInterval(function(){
            updateCharacterPosition(char, 0.10);
        }, 10);

        // Utility: make an element, set a few attributes, append to #output
        function addDomElement(tag, attrs, char) {
            const el = document.createElement(tag);
            if (attrs) {
            for (const k in attrs) {
                if (k === "text") {
                el.textContent = attrs[k];
                } else {
                el.setAttribute(k, attrs[k]);
                }
            }
            }
            outputEl.appendChild(el);
            if (char) {
                char.element = el;
            }
            return el;
        }

        function moveCharacter(char, x, y) {
            char.position[0] = x;
            char.position[1] = y;
            if (char.element) {
                moveElement(char.element, x, y);
            }
        }

        function moveCharacterBy(char, dx, dy) {
            moveCharacter(char, char.position[0] + dx, char.position[1] + dy);
        }

        function addCharacterSpeed(char, dx, dy) {
            char.speed[0] += dx;
            char.speed[1] += dy;
        }

        function setCharacterSpeed(char, dx, dy) {
            char.speed[0] = dx;
            char.speed[1] = dy;
        }

        function updateCharacterPosition(char, t) {
            moveCharacterBy(char, char.speed[0], char.speed[1]);
            
            if (char.position[1] > 300) {
                char.position[1] = 300;
                char.speed[1] = 0;
            }
            else {
                char.speed[1] += t * 9.8; //gravity
                //char.speed[0] *= t * 0.98;
            }
            
        }

        function moveElement(el, x, y) {
            el.style.position = "absolute";
            el.style.left = x + "px";
            el.style.top = y + "px";
        }

        addDomElement("img", { 
            src: "https://media2.giphy.com/media/v1.Y2lkPTZjMDliOTUyeTcyNHM4b3Mya3pmczY5MDBldW4zcDE2dGFsYjFvdjBka2RuNGRvdiZlcD12MV9naWZzX3NlYXJjaCZjdT1n/3vcHdyb75qRIA/200w.gif" 
        }
        , char);

        document.addEventListener("keypress", function(event) {
            console.log("Key pressed:", event.key);

            keyPressed.textContent = event.key.toUpperCase();
            
            switch (event.key) {
                case 'g':
                    setCharacterSpeed(char, 10, 0);
                    keyPressed.textContent = keyPressed.textContent + " - GO FORWARD";
                    break;
                case 'm':
                    setCharacterSpeed(char, -10, 0);
                    keyPressed.textContent = keyPressed.textContent + " - MOVE BACKWARD";
                    break;
                case 'j':
                    if (char.position[1] >= 280) {
                            addCharacterSpeed(char, 0, -20);
                    }
                    keyPressed.textContent = keyPressed.textContent + " - JUMP";
                    break;
            }


            //moveElementBy(outputEl, 1, 1);
        });

        document.addEventListener("keyup", function(event) {
            switch (event.key) {
                case 'g':
                    setCharacterSpeed(char, 0, char.speed[1]);
                    break;
                case 'm':
                    setCharacterSpeed(char, 0, char.speed[1]);
                    break;
            }
        });
        



    </script>

  </body>
</html>